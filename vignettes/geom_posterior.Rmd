---
title: "Plotting Posterior Distributions with ggdistribute"
author: "Joseph M. Burling"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  strip.white = FALSE,
  tidy = FALSE,
  fig.align = "center",
  dpi = 300,
  fig.width = 5.25,
  fig.height = 3.8,
  out.width = "90%",
  out.height = "100%"
)
```

```{r, echo=FALSE, message=FALSE}
library(ggplot2)
library(data.table)
library(magrittr)
theme_set(theme_gray(10))
rebuild_showcase_plot <- TRUE
```

# Introduction

Load the package to access the ggplot2 extensions.

```{r}
library(ggdistribute)
```

Randomly generate a dataset of 5 different normal distributions and assign two different factors `cond` and `grp` to the generated values.

```{r}
mu <- c(-1, 0, 2, 5, 10)
value <- unlist(lapply(mu, function(x) rnorm(1000, x, runif(1, 0.8, 1.2))))
cond <- rep(letters[1:5], each = 1000)
grp <- rep(LETTERS[1:2], each = 2500)
         
data <- data.frame(grp, cond, value)
```

# Extensions passed to `ggplot2::layer`

## `geom_posterior(...)`, `GeomPosterior`

This is the main function wrapper to generate the posterior distribution grobs. See `help("geom_posterior")` for a list of options passed to the ggproto object `GeomPosterior`. The `geom_posterior()` function with no arguments and no `y` aesthetic defaults to estimating the normalized density (integerates to 1) times the number of data points. This is the same as `aes(y = ..count..)` with `geom_posterior`.

```{r}
b_cond <- data[with(data, cond == "b"), ]

ggplot(b_cond, aes(x = value))+
  geom_posterior()
```

If `y` is discrete, the densities are justified at the bottom of the `y` value.

```{r}
ggplot(data, aes(x = value, y = cond))+
  geom_posterior()
```

Mirroring can be turned on to generate densities similar to `geom_violin`, and `geom_posterior` can be used like other `geoms` in `ggplot2`, like specifying facetting.

```{r}
ggplot(data, aes(x = value, y = cond))+
  geom_posterior(mirror = TRUE)+
  facet_grid(grp~., scales = "free_y")
```

## `stat_density_ci(...)`, `StatDensityCI`

The `StatDensityCI` class is the default stat for the `geom_posterior` wrapper. It computes densities for each group and finds the confidence intervals. See `help("stat_density_ci")` for additional options and computed variables.

```{r}
ggplot(data, aes(x = value, y = cond))+
  stat_density_ci(n = 1024, interp_thresh = .001)
```

The `stat_density_ci` wrapper can also be used with other geoms that make use of `density`, `count`, and `scaled` variables.

```{r}
ggplot(data, aes(x = value, y = ..density.., fill=cond))+
  stat_density_ci(alpha = 0.5, n = 1024, geom = "density", position = "identity")
```

## `position_spread(...)`, `PositionSpread`

The `PositionSpread` class spreads out overlapping densities within the range of their y axis value. For instance, condition `c`, there are two different groups in `grp`. Each group in `c` is resized and spread over the group interval. Padding is turned off below to see where distributions begin and end.

```{r}
ggplot(data, aes(x = value, y = cond, group = grp))+
  geom_posterior(position = position_spread(padding = 0))+
  theme(panel.grid.major.y = element_line(color = gray(.8)))
```


# Extended example

An overview of combining `ggdistribute` with other `ggplot2` elements.

## Theme setup

Setup theme options for the final plot.

```{r, echo=FALSE, results='hide', message=FALSE}
font <- "serif"
if (rebuild_showcase_plot) {
  if (requireNamespace("extrafont", quietly = TRUE)) {
    library(extrafont)
    font <- "Oswald Medium"
  } else {
    
  }
  
  theme_set(theme_mejr(base_family = font))
}else {
  theme_set(theme_gray(base_family = font))
}
```

```{r, echo=FALSE}
ggdistribute:::print_fn(ex_plot_fn_chunk, example_plot)
```

```{r print_ex_plot, ref.label="ex_plot_fn_chunk"}
```

Print the plot to the graphics device.

```{r, fig.width=5, fig.height=3, out.width="100%"}
plot(example_plot())
```

```{r, echo=FALSE, message=FALSE, results='hide'}
if (rebuild_showcase_plot) {
  ggsave(
    file = file.path("media", "example_fig.png"),
    example_plot(),
    device = "png",
    width = 5,
    height = 3,
    units = "in",
    family = font,
    dpi = 600)
}
```


```{r, eval=FALSE, echo=FALSE}
# other tests
dt <- ggdistribute:::ggdist_data(1000, j=5)

ggplot(dt) + aes(x = value) +
  geom_posterior(n=32)

ggplot(dt) + aes(x = value) +
  geom_posterior(n=32, aes(group=j_discrete))

ggplot(dt) + aes(x = value, y=j_discrete) +
  geom_posterior(n=32, position = position_spread(height = 20))

ggplot(dt) + aes(x = value, y=j_discrete, group = k_discrete) +
  geom_posterior(n=32)

ggplot(dt) + aes(x = value, y=10) +
  geom_posterior(n=32)

ggplot(dt) + aes(x = value, y=j_discrete) +
  geom_posterior(n=32, aes(group=j_discrete))

ggplot(dt) + aes(x = value, y=j_discrete) +
  geom_posterior(n=32, aes(fill=k_discrete))

ggplot(dt) + aes(x = value, y=I) +
  geom_posterior(n=32, aes(group=j_discrete))

ggplot(dt) + aes(x = value, y=variable) +
  geom_posterior(n=32, mirror = F, aes(group=j_discrete))

ggplot(dt) + aes(x = value, y=variable * 10) +
  geom_posterior(n=32, mirror = F, aes(group=j_discrete))+
  facet_wrap(~k_discrete)

ggplot(dt) + aes(x = value, y=k_discrete) +
  geom_posterior(n=32, aes(group=j_discrete))
```
